#!/bin/bash

# wget -O - https://raw.githubusercontent.com/pyPTV/url/master/socks5 | bash


# Prompt the user for their home static IP address
read -p "Enter your home static IP address: " home_ip

# Check if the IP was entered
if [ -z "$home_ip" ]; then
    echo "No IP address entered. Exiting."
    exit 1
fi

# Now proceed with the installation and configuration
sudo apt update
sudo apt install -y dante-server

# Configure dante-server (SOCKS5 proxy) with access restricted to the provided static IP
sudo tee /etc/danted.conf > /dev/null << EOF
# Specify the network interface and port Dante listens on
internal: ens5 port = 1809
external: ens5

# Use "none" method for SOCKS5 authentication to make it anonymous
method: none

# Specify the user for running the Dante server
user.privileged: root
user.notprivileged: nobody

# Client rules: allow connections only from your home static IP
client pass {
    from: $home_ip/32 to: 0.0.0.0/0
    log: connect disconnect error
}
client block {
    from: 0.0.0.0/0 to: 0.0.0.0/0
    log: connect disconnect error
}

# SOCKS pass rules: allow clients to use the proxy
socks pass {
    from: $home_ip/32 to: 0.0.0.0/0
    log: connect disconnect error
    method: none
}
socks block {
    from: 0.0.0.0/0 to: 0.0.0.0/0
    log: connect disconnect error
}
EOF

# Restart Dante to apply changes
sudo systemctl restart danted
sudo systemctl enable danted

echo "SOCKS5 proxy has been set up with access restricted to your home static IP: $home_ip"

